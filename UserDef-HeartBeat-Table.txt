https://www.safaribooksonline.com/library/view/oracle-goldengate-11g/9781849686143/ch06s09.html



--Create a Heartbeat table in the source database as follows:

 CREATE TABLE C022427.GGS_UD_HEARTBEAT
 ( 
 ID NUMBER ,
 SRC_DB VARCHAR2(30),
 EXTRACT_NAME varchar2(8),
 SOURCE_COMMIT TIMESTAMP, 
 TARGET_COMMIT TIMESTAMP,
 CAPTIME TIMESTAMP, 
 CAPLAG NUMBER, 
 PMPTIME TIMESTAMP, 
 PMPGROUP VARCHAR2(8 BYTE),
 PMPLAG NUMBER, 
 DELTIME TIMESTAMP, 
 DELGROUP VARCHAR2(8 BYTE), 
 DELLAG NUMBER, 
 TOTALLAG NUMBER,
 thread number, 
 update_timestamp timestamp, 
 EDDLDELTASTATS number, 
 EDMLDELTASTATS number, 
 RDDLDELTASTATS number, 
 RDMLDELTASTATS number, 
 CONSTRAINT HEARTBEAT_PK PRIMARY KEY (THREAD) ENABLE);
 
 --Insert the Heartbeat record in this table using the following command:
 INSERT INTO C022427.GGS_UD_HEARTBEAT(THREAD) SELECT THREAD# FROM V$INSTANCE;
 
 
 --Login to GGSCI and add Supplemental Logging for this new table in the source environment as follows:
 
 GGSCI (prim1-ol6-112.localdomain) 1> DBLOGIN USERID C022427@DBORATEST
 
 GGSCI (prim1-ol6-112.localdomain) 2> ADD TRANDATA C022427.GGS_UD_HEARTBEAT
 
 
 
 --Create a procedure in the source database to update the Heartbeat record as follows:
 
CREATE OR REPLACE PROCEDURE GG_UPDATE_HB_TAB IS
BEGIN
UPDATE GGS_UD_HEARTBEAT 
SET 
UPDATE_TIMESTAMP = SYSTIMESTAMP ,
SRC_DB = 'SOAUAT1JGB' 
WHERE THREAD = 1;
COMMIT;
END;
/
 
--Create a scheduler job in the source database to update the Heartbeat record every minute as follows:

BEGIN
SYS.DBMS_SCHEDULER.CREATE_JOB (
JOB_NAME => '"C022427"."GGS_HB"',
JOB_TYPE => 'STORED_PROCEDURE',
JOB_ACTION => '"C022427"."GG_UPDATE_HB_TAB"',
NUMBER_OF_ARGUMENTS => 0,
START_DATE => NULL,
REPEAT_INTERVAL => 'FREQ=MINUTELY',
END_DATE => NULL,
JOB_CLASS => '"SYS"."DEFAULT_JOB_CLASS"',
ENABLED => FALSE,
AUTO_DROP => FALSE,
COMMENTS => 'GoldenGate Heartbeat Update Job',
CREDENTIAL_NAME => NULL,
DESTINATION_NAME => NULL);
SYS.DBMS_SCHEDULER.SET_ATTRIBUTE(NAME => '"C022427"."GGS_HB"',ATTRIBUTE => 'RESTARTABLE', VALUE => TRUE);
SYS.DBMS_SCHEDULER.SET_ATTRIBUTE(NAME => '"C022427"."GGS_HB"', ATTRIBUTE => 'LOGGING_LEVEL', VALUE => DBMS_SCHEDULER.LOGGING_OFF);
SYS.DBMS_SCHEDULER.ENABLE(NAME => '"C022427"."GGS_HB"');
END;
/


--TARGET
--Log in to the target database and create a sequence for the History table as follows:

CREATE SEQUENCE C022427.SEQ_GGS_UD_HEARTBEAT_ID INCREMENT BY 1 START WITH 1 ORDER;



--Create the Heartbeat table in the target database as follows:

 CREATE TABLE C022427.GGS_UD_HEARTBEAT
(
ID NUMBER ,
SRC_DB VARCHAR2(30),
EXTRACT_NAME varchar2(8),
SOURCE_COMMIT TIMESTAMP, 
TARGET_COMMIT TIMESTAMP, 
CAPTIME TIMESTAMP,
CAPLAG NUMBER, 
PMPTIME TIMESTAMP, 
PMPGROUP VARCHAR2(8 BYTE), 
PMPLAG NUMBER,
DELTIME TIMESTAMP, 
DELGROUP VARCHAR2(8 BYTE), 
DELLAG NUMBER, 
TOTALLAG NUMBER, 
thread number, 
update_timestamp timestamp,
EDDLDELTASTATS number,
EDMLDELTASTATS number, 
RDDLDELTASTATS number, 
RDMLDELTASTATS number,
CONSTRAINT GGS_UD_HEARTBEAT_PK PRIMARY KEY (DELGROUP) ENABLE
);


--Create a sequence for the Heartbeat_History table in the target database as follows:

 CREATE SEQUENCE C022427.SEQ_GGS_UD_HEARTBEAT_HIST INCREMENT BY 1 START WITH 1 ORDER ;
 
 
 
 --Create a Heartbeart_History table in the target database as follows:
 
 CREATE TABLE C022427.GGS_UD_HEARTBEAT_HISTORY
 (
 ID NUMBER ,
SRC_DB VARCHAR2(30),
EXTRACT_NAME varchar2(8),
SOURCE_COMMIT TIMESTAMP,
TARGET_COMMIT TIMESTAMP, 
CAPTIME TIMESTAMP, 
CAPLAG NUMBER,
PMPTIME TIMESTAMP,
PMPGROUP VARCHAR2(8 BYTE),
PMPLAG NUMBER, 
DELTIME TIMESTAMP, 
DELGROUP VARCHAR2(8 BYTE),
DELLAG NUMBER, 
TOTALLAG 	NUMBER,
thread number,
update_timestamp timestamp,
EDDLDELTASTATS	number, 
EDMLDELTASTATS	number,
RDDLDELTASTATS	number, 
RDMLDELTASTATS	number, 
CONSTRAINT GGS_UD_HEARTBEAT_HIST_PK PRIMARY KEY (ID) ENABLE );

 
 CREATE SEQUENCE SEQ_GGS_UD_HEARTBEAT_ID INCREMENT BY 1 START WITH 1 ORDER;


--Create a trigger to update the Lag columns for the Heartbeat table as follows:

CREATE OR REPLACE TRIGGER C022427.GGS_UD_HEARTBEAT_TRIG
BEFORE INSERT OR UPDATE ON C022427.GGS_UD_HEARTBEAT
FOR EACH ROW
BEGIN
SELECT SEQ_GGS_UD_HEARTBEAT_ID.NEXTVAL INTO :NEW.ID FROM DUAL;

SELECT SYSTIMESTAMP INTO :NEW.TARGET_COMMIT FROM DUAL;

SELECT TRUNC(TO_NUMBER(SUBSTR((:NEW.CAPTIME - :NEW.SOURCE_COMMIT ),1, INSTR(:NEW.CAPTIME - :NEW.SOURCE_COMMIT,' ')))) * 
86400 + TO_NUMBER(SUBSTR((:NEW.CAPTIME - :NEW.SOURCE_COMMIT), 
INSTR((:NEW.CAPTIME - :NEW.SOURCE_COMMIT),' ')+1,2)) * 3600 +
TO_NUMBER(SUBSTR((:NEW.CAPTIME - :NEW.SOURCE_COMMIT), INSTR((:NEW.CAPTIME - :NEW.SOURCE_COMMIT),' ')+4,2) ) 
* 60+ TO_NUMBER(SUBSTR((:NEW.CAPTIME - :NEW.SOURCE_COMMIT), INSTR((:NEW.CAPTIME - :NEW.SOURCE_COMMIT),' ')+7,2)) + 
TO_NUMBER(SUBSTR((:NEW.CAPTIME - :NEW.SOURCE_COMMIT), INSTR((:NEW.CAPTIME - :NEW.SOURCE_COMMIT),' ')+10,6)) / 1000000
INTO :NEW.CAPLAG FROM DUAL;

SELECT TRUNC(TO_NUMBER(SUBSTR((:NEW.PMPTIME - :NEW.CAPTIME),1, INSTR(:NEW.PMPTIME - :NEW.CAPTIME,' ')))) 
* 86400+ TO_NUMBER(SUBSTR((:NEW.PMPTIME - :NEW.CAPTIME), INSTR((:NEW.PMPTIME - :NEW.CAPTIME),' ')+1,2)) 
* 3600+ TO_NUMBER(SUBSTR((:NEW.PMPTIME - :NEW.CAPTIME),
INSTR((:NEW.PMPTIME - :NEW.CAPTIME),' ')+4,2) ) * 60 + 
TO_NUMBER(SUBSTR((:NEW.PMPTIME - :NEW.CAPTIME), INSTR((:NEW.PMPTIME - :NEW.CAPTIME),' ')+7,2)) + 
TO_NUMBER(SUBSTR((:NEW.PMPTIME - :NEW.CAPTIME), INSTR((:NEW.PMPTIME - :NEW.CAPTIME),' ')+10,6)) / 1000000 
INTO :NEW.PMPLAG FROM DUAL;

SELECT TRUNC(TO_NUMBER(SUBSTR((:NEW.DELTIME - :NEW.PMPTIME),1, INSTR(:NEW.DELTIME - :NEW.PMPTIME,' ')))) *
86400 + TO_NUMBER(SUBSTR((:NEW.DELTIME - :NEW.PMPTIME), INSTR((:NEW.DELTIME - :NEW.PMPTIME),' ')+ 1,2)) * 3600 +
TO_NUMBER(SUBSTR((:NEW.DELTIME - :NEW.PMPTIME), INSTR((:NEW.DELTIME - :NEW.PMPTIME),' ')+4,2) ) * 60 +
TO_NUMBER(SUBSTR((:NEW.DELTIME - :NEW.PMPTIME), INSTR((:NEW.DELTIME - :NEW.PMPTIME),' ')+7,2)) + 
TO_NUMBER(SUBSTR((:NEW.DELTIME - :NEW.PMPTIME), INSTR((:NEW.DELTIME - :NEW.PMPTIME),' ')+10,6)) / 1000000
INTO :NEW.DELLAG
FROM DUAL;

SELECT TRUNC(TO_NUMBER(SUBSTR((:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT),1, 
INSTR(:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT,' ')))) * 86400 + 
TO_NUMBER(SUBSTR((:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT),
INSTR((:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT),' ')+1,2)) * 3600 + 
TO_NUMBER(SUBSTR((:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT), INSTR((:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT),' ')+4,2) ) * 60
+ TO_NUMBER(SUBSTR((:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT), INSTR((:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT),' ')+7,2))
+ TO_NUMBER(SUBSTR((:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT), INSTR((:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT),' ')+10,6)) / 1000000
INTO :NEW.TOTALLAG
FROM DUAL;
END ;
/  


  CREATE SEQUENCE C022427.SEQ_GGS_UD_HEARTBEAT_HIST INCREMENT BY 1 START WITH 1 ORDER ;


--Create a trigger to update the Lag columns for the Heartbeat_History table in the target database as follows:

CREATE OR REPLACE TRIGGER C022427.GGS_UD_HEARTBEAT_TRIG_HIST 
BEFORE INSERT OR UPDATE ON C022427.GGS_UD_HEARTBEAT_HISTORY
FOR EACH ROW
BEGIN
SELECT SEQ_GGS_UD_HEARTBEAT_HIST.NEXTVAL INTO :NEW.ID FROM DUAL;

SELECT SYSTIMESTAMP INTO :NEW.TARGET_COMMIT FROM DUAL;

SELECT TRUNC(TO_NUMBER(SUBSTR((:NEW.CAPTIME - :NEW.SOURCE_COMMIT ),1, INSTR(:NEW.CAPTIME - :NEW.SOURCE_COMMIT,' ')))) * 
86400 + TO_NUMBER(SUBSTR((:NEW.CAPTIME - :NEW.SOURCE_COMMIT), INSTR((:NEW.CAPTIME - :NEW.SOURCE_COMMIT),' ')+1,2))
* 3600 + TO_NUMBER(SUBSTR((:NEW.CAPTIME - :NEW.SOURCE_COMMIT), INSTR((:NEW.CAPTIME - :NEW.SOURCE_COMMIT),' ')+4,2) )
* 60 + TO_NUMBER(SUBSTR((:NEW.CAPTIME - :NEW.SOURCE_COMMIT), INSTR((:NEW.CAPTIME - :NEW.SOURCE_COMMIT),' ')+7,2))+ 
TO_NUMBER(SUBSTR((:NEW.CAPTIME - :NEW.SOURCE_COMMIT), INSTR((:NEW.CAPTIME - :NEW.SOURCE_COMMIT),' ')+10,6)) / 1000000
INTO :NEW.CAPLAG FROM DUAL;

SELECT TRUNC(TO_NUMBER(SUBSTR((:NEW.PMPTIME - :NEW.CAPTIME),1, INSTR(:NEW.PMPTIME - :NEW.CAPTIME,' ')))) 
* 86400+ TO_NUMBER(SUBSTR((:NEW.PMPTIME - :NEW.CAPTIME), INSTR((:NEW.PMPTIME - :NEW.CAPTIME),' ')+1,2)) * 
3600 + TO_NUMBER(SUBSTR((:NEW.PMPTIME - :NEW.CAPTIME), INSTR((:NEW.PMPTIME - :NEW.CAPTIME),' ')+4,2) ) *
60 + TO_NUMBER(SUBSTR((:NEW.PMPTIME - :NEW.CAPTIME), INSTR((:NEW.PMPTIME - :NEW.CAPTIME),' ')+7,2)) + 
TO_NUMBER(SUBSTR((:NEW.PMPTIME - :NEW.CAPTIME), INSTR((:NEW.PMPTIME - :NEW.CAPTIME),' ')+10,6)) / 1000000
INTO :NEW.PMPLAG
FROM DUAL;

SELECT TRUNC(TO_NUMBER(SUBSTR((:NEW.DELTIME - :NEW.PMPTIME),1, INSTR(:NEW.DELTIME - :NEW.PMPTIME,' ')))) *
86400 + TO_NUMBER(SUBSTR((:NEW.DELTIME - :NEW.PMPTIME), INSTR((:NEW.DELTIME - :NEW.PMPTIME),' ')+1,2)) * 
3600 + TO_NUMBER(SUBSTR((:NEW.DELTIME - :NEW.PMPTIME), INSTR((:NEW.DELTIME - :NEW.PMPTIME),' ')+4,2) ) * 60 
+ TO_NUMBER(SUBSTR((:NEW.DELTIME - :NEW.PMPTIME), INSTR((:NEW.DELTIME - :NEW.PMPTIME),' ')+7,2))
+ TO_NUMBER(SUBSTR((:NEW.DELTIME - :NEW.PMPTIME), INSTR((:NEW.DELTIME - :NEW.PMPTIME),' ')+10,6)) / 1000000
INTO :NEW.DELLAG
FROM DUAL;

SELECT TRUNC(TO_NUMBER(SUBSTR((:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT),1, INSTR(:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT,' '))))
* 86400 + TO_NUMBER(SUBSTR((:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT), INSTR((:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT),' ')+1,2)) *
3600 + TO_NUMBER(SUBSTR((:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT), INSTR((:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT),' ')+4,2) ) *
60 + TO_NUMBER(SUBSTR((:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT), INSTR((:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT),' ')+7,2)) + 
TO_NUMBER(SUBSTR((:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT), INSTR((:NEW.TARGET_COMMIT - :NEW.SOURCE_COMMIT),' ')+10,6)) / 1000000
INTO :NEW.TOTALLAG
FROM DUAL;
END ;
/


--Stop the replication process in the source and target environment by the following command:

GGSCI> STOP ER *



--Edit the Extract Parameter file in the source environment and add the Heartbeat table in the list as follows:

EXTRACT EGGTEST1USERID C022427@DBORATEST, PASSWORD C022427EXTTRAIL /u01/app/ggate/dirdat/stTABLE SCOTT.*;TABLE C022427.GGS_UD_HEARTBEAT,TOKENS (CAPGROUP = @GETENV ("GGENVIRONMENT", "GROUPNAME"),CAPTIME =  @DATE ("YYYY-MM-DD HH:MI:SS.FFFFFF","JTS",@GETENV ("JULIANTIMESTAMP")),EDDLDELTASTATS = @GETENV ("DELTASTATS", "DDL"),EDMLDELTASTATS = @GETENV ("DELTASTATS", "DML"));



--Edit the Datapump Parameter file and add the Heartbeat table to the list as follows:

EXTRACT PGGTEST1USERID C022427@DBORATEST, PASSWORD C022427RMTHOST 192.168.0.11 , MGRPORT 8809RMTTRAIL /u01/app/ggate/dirdat/rtNOPASSTHRUTABLE C022427.GGS_UD_HEARTBEAT,TOKENS (PMPGROUP = @GETENV ("GGENVIRONMENT","GROUPNAME"),PMPTIME = @DATE ("YYYY-MM-DD HH:MI:SS.FFFFFF","JTS",@GETENV ("JULIANTIMESTAMP")));PASSTHRUTABLE SCOTT.*;



--Edit the Replicat Parameter file in the target environment and add the mapping information for the Heartbeat and Heartbeat_History tables as follows:

REPLICAT RGGTEST1USERID C022427@TGORTEST, PASSWORD C022427DISCARDFILE /U01/APP/GGATE/DIRRPT/RGGTEST1.DSC,APPEND,MEGABYTES 500ASSUMETARGETDEFSMAP SCOTT.*, TARGET SCOTT.*;MAP C022427.GGS_UD_HEARTBEAT, TARGET C022427.GGS_UD_HEARTBEAT,KEYCOLS (DELGROUP),INSERTMISSINGUPDATES,COLMAP (USEDEFAULTS,ID = 0,SOURCE_COMMIT = @GETENV ("GGHEADER", "COMMITTIMESTAMP"),EXTRACT_NAME = @TOKEN ("CAPGROUP"),CAPTIME = @TOKEN ("CAPTIME"),PMPGROUP = @TOKEN ("PMPGROUP"),PMPTIME = @TOKEN ("PMPTIME"),DELGROUP = @GETENV ("GGENVIRONMENT", "GROUPNAME"),DELTIME =  @DATE ("YYYY-MM-DD HH:MI:SS.FFFFFF","JTS",@GETENV ("JULIANTIMESTAMP")),EDDLDELTASTATS = @TOKEN ("EDDLDELTASTATS"),EDMLDELTASTATS = @TOKEN ("EDMLDELTASTATS"),RDDLDELTASTATS = @GETENV ("DELTASTATS", "DDL"),RDMLDELTASTATS = @GETENV ("DELTASTATS", "DML"));MAP C022427.GGS_UD_HEARTBEAT, TARGET C022427.GGS_UD_HEARTBEAT_HISTORY,KEYCOLS (ID),INSERTALLRECORDS,COLMAP (USEDEFAULTS,ID = 0,SOURCE_COMMIT = @GETENV ("GGHEADER", "COMMITTIMESTAMP"),EXTRACT_NAME = @TOKEN ("CAPGROUP"),CAPTIME = @TOKEN ("CAPTIME"),PMPGROUP = @TOKEN ("PMPGROUP"),PMPTIME = @TOKEN ("PMPTIME"),DELGROUP = @GETENV ("GGENVIRONMENT", "GROUPNAME"),DELTIME =  @DATE ("YYYY-MM-DD HH:MI:SS.FFFFFF","JTS",@GETENV ("JULIANTIMESTAMP")),EDDLDELTASTATS = @TOKEN ("EDDLDELTASTATS"),EDMLDELTASTATS = @TOKEN ("EDMLDELTASTATS"),RDDLDELTASTATS = @GETENV ("DELTASTATS", "DDL"),RDMLDELTASTATS = @GETENV ("DELTASTATS", "DML"));



--Start the Extract and Datapump in the source environment as follows:

GGSCI (prim1-ol6-112.localdomain) 11> START EXTRACT EGGTEST1
Sending START request to MANAGER ...EXTRACT EGGTEST1 starting
GGSCI (prim1-ol6-112.localdomain) 12> START EXTRACT PGGTEST1
Sending START request to MANAGER ...EXTRACT PGGTEST1 starting




--Start the Replicat process in the target environment as follows:

GGSCI (stdby1-ol6-112.localdomain) 2> START REPLICAT RGGTEST1
Sending START request to MANAGER ...REPLICAT RGGTEST1 starting


--Verify whether the Heartbeat is working by querying the GGS_UD_HEARTBEAT and GGS_UD_HEARTBEAT_HISTORY tables in the target environment as follows:

SQL> SELECT CAPLAG,PMPLAG, DELLAG FROM C022427.GGS_UD_HEARTBEAT;   
CAPLAG     PMPLAG    DELLAG
---------- ---------- ----------  
2.304362   2.004874  1.869005

SQL> SELECT CAPLAG,PMPLAG, DELLAG FROM C022427.GGS_UD_HEARTBEAT_HISTORY;    

CAPLAG     PMPLAG    DELLAG
---------- ---------- ----------  
17.88579  13.066255  3.620444  
2.189226   1.970397  1.748129  
2.304362   2.004874  1.869005







=================================================================================================================

mkdir ./dirdat/EGGTEST1

EXTRACT EGGTEST1

INCLUDE ./dirmac/exception_handler.mac

SETENV (ORACLE_SID = "SOAUAT1")
SETENV (ORACLE_HOME="/u01/app/oracle/product/ora1210/db_1")
SETENV (NLS_LANG="AMERICAN_AMERICA.AL32UTF8")

USERIDALIAS SOAUAT1ADM DOMAIN admin

EXTTRAIL ./dirdat/EGGTEST1/sa

#gg_extract_report_settings();

#gg_extract_settings();

TABLE C022427.GGS_UD_HEARTBEAT , GETBEFORECOLS (ON UPDATE ALL, ON DELETE ALL), &
TOKENS ( &
CAPGROUP = @GETENV('GGENVIRONMENT', 'GROUPNAME'), &
CAPTIME = @DATE('YYYY-MM-DD HH:MI:SS.FFFFFF','JTS',@GETENV ('JULIANTIMESTAMP')), &
EDDLDELTASTATS = @GETENV('DELTASTATS', 'DDL'), &
EDMLDELTASTATS = @GETENV('DELTASTATS', 'DML'));





2.


EXTRACT PGGTEST1

INCLUDE ./dirmac/exception_handler.mac

USERIDALIAS SOAUAT1ADM DOMAIN admin

RMTHOST ctdbsoa02sv, MGRPORT 7809
RMTTRAIL ./dirdat/EGGTEST1/ta

#gg_dpump_report_settings();

TABLE C022427.GGS_UD_HEARTBEAT, &
TOKENS ( &
PMPGROUP = @GETENV('GGENVIRONMENT','GROUPNAME'), &
PMPTIME  = @DATE('YYYY-MM-DD HH:MI:SS.FFFFFF','JTS',@GETENV('JULIANTIMESTAMP')));



REPLICAT RGGTEST1

INCLUDE ./dirmac/exception_handler.mac

SETENV (ORACLE_SID = "SOAUAT2")
SETENV (ORACLE_HOME="/u01/app/oracle/product/ora1210/db_1")
SETENV (NLS_LANG="AMERICAN_AMERICA.AL32UTF8")


USERIDALIAS SOAUAT2ADM domain admin

DISCARDFILE dirrpt/RGGTEST1.DSC,APPEND,MEGABYTES 500

#gg_replicat_report_settings();

#r_reperror();

#gg_replicat_settings();

MAP C022427.GGS_UD_HEARTBEAT, TARGET C022427.GGS_UD_HEARTBEAT, &
KEYCOLS (DELGROUP),  &
INSERTMISSINGUPDATES,  &
COLMAP  &
(  &
USEDEFAULTS,ID = 0,
SOURCE_COMMIT  = @GETENV('GGHEADER', 'COMMITTIMESTAMP'),  &
EXTRACT_NAME   = @TOKEN('CAPGROUP'),  &
CAPTIME        = @TOKEN('CAPTIME'),  &
PMPGROUP       = @TOKEN('PMPGROUP'),  &
PMPTIME        = @TOKEN('PMPTIME'),  &
DELGROUP       = @GETENV('GGENVIRONMENT', 'GROUPNAME'),  &
DELTIME        = @DATE('YYYY-MM-DD HH:MI:SS.FFFFFF','JTS',@GETENV('JULIANTIMESTAMP')),  &
EDDLDELTASTATS = @TOKEN('EDDLDELTASTATS'),  &
EDMLDELTASTATS = @TOKEN('EDMLDELTASTATS'),  &
RDDLDELTASTATS = @GETENV('DELTASTATS', 'DDL'),  &
RDMLDELTASTATS = @GETENV('DELTASTATS', 'DML'));

MAP C022427.GGS_UD_HEARTBEAT, TARGET C022427.GGS_UD_HEARTBEAT_HISTORY,  &
KEYCOLS (ID),  &
INSERTALLRECORDS,  &
COLMAP (USEDEFAULTS,  &
ID = 0,  &
SOURCE_COMMIT  = @GETENV('GGHEADER', 'COMMITTIMESTAMP'),  &
EXTRACT_NAME   = @TOKEN('CAPGROUP'),  &
CAPTIME        = @TOKEN('CAPTIME'),  &
PMPGROUP       = @TOKEN('PMPGROUP'),  &
PMPTIME        = @TOKEN('PMPTIME'),  &
DELGROUP       = @GETENV('GGENVIRONMENT', 'GROUPNAME'),  &
DELTIME        = @DATE('YYYY-MM-DD HH:MI:SS.FFFFFF','JTS',@GETENV('JULIANTIMESTAMP')),  &
EDDLDELTASTATS = @TOKEN('EDDLDELTASTATS'),  &
EDMLDELTASTATS = @TOKEN('EDMLDELTASTATS'),  &
RDDLDELTASTATS = @GETENV('DELTASTATS', 'DDL'),  &
RDMLDELTASTATS = @GETENV('DELTASTATS', 'DML'));



=================================================================================================================
